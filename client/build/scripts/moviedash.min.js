angular.module("moviedash",["moviedash.landing","moviedash.movies","moviedash.details","moviedash.services","ui.router","ngMap","ui.bootstrap"]).config(function(a,b){b.otherwise("/landing"),a.state("landing",{url:"/landing",controller:"LandingCtrl",templateUrl:"app/landing/landing.html"}).state("movies",{url:"/movies",controller:"MoviesCtrl",templateUrl:"app/movies/movies.html"}).state("details",{url:"/details",controller:"DetailsCtrl",templateUrl:"app/details/details.html"})}),angular.module("moviedash.details",[]).controller("DetailsCtrl",function(a,b){a.movie=b.getStorage("movie"),a.origin=b.getStorage("location"),a.destination=a.movie.theaterAddress,a.travelMode=b.getStorage("modality")?b.getStorage("modality").toUpperCase():"DRIVING",a.departure_time="TRANSIT"===a.travelMode?new Date((new Date).getTime()+parseInt(b.getStorage("leavingTime"))):new Date,a.transit_options={departureTime:a.departure_time}});var app=angular.module("moviedash.landing",[]);app.controller("LandingCtrl",function(a,b,c,d){a.modality="driving",a.leavingTime="0",a.findLocation=function(){function b(b){a.isLoading=!1;var c=b.coords.latitude,d=b.coords.longitude;e(c,d)}function c(){a.isLoading=!1,a.error="Unable to retrieve location. Please enter your zipcode."}a.error=null,a.isLoading=!0,navigator.geolocation||(a.error="Geolocation is not supported by your browser. Please enter your zipcode."),navigator.geolocation.getCurrentPosition(b,c)},a.zipSubmit=function(){a.isLoading=!0,a.error=null,d.get("http://maps.googleapis.com/maps/api/geocode/json?address="+a.zip).then(function(a){var b=a.data.results[0].geometry.location.lat,c=a.data.results[0].geometry.location.lng;e(b,c)})};var e=function(b,d){a.location=b+", "+d,a.query={location:a.location,modality:a.modality,leavingTime:a.leavingTime},c.getTheaters(a.query).then(function(a){f(a)})},f=function(d){return a.isLoading=!1,d.data?(c.setResults(d),void b.path("/movies")):void(a.error="No movies are available at this time. Please try again later.")}}),angular.module("moviedash.movies",[]).controller("MoviesCtrl",function(a,b,c,d,e,f){a.selectMovie=function(c){d.setStorage("movie",a.movies[c]),b.path("/details")},a.movies=c.getResults().data,a.showTrailer=function(b){var c=a.movies[b].trailerLink;if(c!==!1){var d=c.slice(c.indexOf("=")+1),g="http://www.youtube.com/embed/"+d+"?autoplay=1";a.title=a.movies[b].movieName,a.trailerUrl=f.trustAsResourceUrl(g),a.$modalInstance=e.open({templateUrl:"../App/movies/videoplayer.html",controller:"MoviesCtrl",size:"lg",scope:a})}},a.closeTrailer=function(){a.$modalInstance.close("")}});var app=angular.module("moviedash.services",[]);app.factory("MovieClient",function(a,b){var c=function(a){b.setStorage("movieInfo",a)},d=function(){return b.getStorage("movieInfo")},e=function(c){return b.setStorage("location",c.location),b.setStorage("modality",c.modality),b.setStorage("leavingTime",c.leavingTime),a({method:"POST",data:c,url:"/api/movies",success:function(a){return a},error:function(a){console.log(a)}})};return{getTheaters:e,setResults:c,getResults:d}}),app.factory("selected",function(){var a=function(a,b){sessionStorage[a]=angular.toJson(b)},b=function(a){return angular.fromJson(sessionStorage[a])};return{setStorage:a,getStorage:b}}),app.filter("timeFromNow",function(){return function(a){var b=Math.round((a-new Date)/1e3);if(0>b)return"Expired";var c=Math.round(b/60);return c.toString()+" minutes from now"}});